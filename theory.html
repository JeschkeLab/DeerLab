

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Theory &mdash; DeerLab</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/plot_directive.css" type="text/css" />
  <link rel="stylesheet" href="/source/_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="/source/_static/theme_override.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/table_util.css" type="text/css" />
  <link rel="stylesheet" href="_static/table_main.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_override.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery-rendered-html.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contributing" href="contributing.html" />
    <link rel="prev" title="ex_ridme7" href="models/ex_ridme7.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                v0.13.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Home</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="beginners_guide.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="uncertainty.html">Uncertainty</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="modelsref.html">Models</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Theory</a></li>
</ul>
<p class="caption"><span class="caption-text">Others</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="funding.html">Funding</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Release Notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">DeerLab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Theory</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="theory">
<span id="id1"></span><h1>Theory<a class="headerlink" href="#theory" title="Permalink to this headline">¶</a></h1>
<p>This section summarizes key aspects of the theory implemented in DeerLab.</p>
<div class="section" id="assumptions">
<h2>Assumptions<a class="headerlink" href="#assumptions" title="Permalink to this headline">¶</a></h2>
<p>The theory underlying DeerLab is not fully general and makes a series of assumptions about the sample and the experiment. The important ones are:</p>
<ol class="arabic simple">
<li>All spin labels are spin-1/2 or can be treated as such. High-spin systems are not handled by DeerLab.</li>
<li>There are no more than two spin labels on a protein (or other cluster). Multi-spin effects are not handled by DeerLab.</li>
<li>The unpaired electron spin density on the spin labels can be treated as localized in a single point. Delocalized spin systems are not handled by DeerLab.</li>
<li>All spins have essentially isotropic g values close to 2.00232. Spins with large g shifts and anisotropic g tensors are not handled by DeerLab.</li>
<li>There is no exchange coupling between any spins. The only interaction is through-space dipolar coupling. Exchange coupling is not handled by DeerLab.</li>
<li>The dipolar coupling between spins is in the weak-coupling regime, i.e. it is weaker than the difference between their resonance frequencies. Intermediate- and strong-coupling regimes are not handled by DeerLab.</li>
<li>All spins relax with the same phase memory time. Systems with rotamer-specific relaxation rates are not handled by DeerLab.</li>
<li>The signal is free of modulations due to hyperfine couplings (ESEEM).</li>
<li>There is no orientation selection in the experiment. Orientation-selective DEER is not handled by DeerLab.</li>
</ol>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If your sample and experiment do not satisfy all these assumptions, DeerLab will give incorrect results.</p>
</div>
</div>
<div class="section" id="distance-distributions">
<h2>Distance distributions<a class="headerlink" href="#distance-distributions" title="Permalink to this headline">¶</a></h2>
<p>In DeerLab, distance distributions are assumed to be normalized</p>
<div class="math">
<p><img src="_images/math/fb01c37b3220ac31474d4f59965ef7f7e7ddeba6.svg" alt="\int_0^\infty P(r)\mr{d}r = 1"/></p>
</div></div>
<div class="section" id="dipolar-signals-and-kernels">
<h2>Dipolar signals and kernels<a class="headerlink" href="#dipolar-signals-and-kernels" title="Permalink to this headline">¶</a></h2>
<p>A dipolar signal <img class="math" src="_images/math/963ea147e7d9131e587b022ae43bd92cd9341079.svg" alt="V(t)"/> is calculated from a distance distribution <img class="math" src="_images/math/6cebf32760d986ec00c67495c4b6c78491a36dd3.svg" alt="P(r)"/> with the Fredholm integral of the first kind:</p>
<div class="math">
<p><img src="_images/math/d44c02e1a823d1c6546e41839e899da3c6e931b2.svg" alt="V(t) = \int_0^\infty K(t,r)P(r)\mathrm{d}r"/></p>
</div><p>In this equation, <img class="math" src="_images/math/b95b71282e37e5adb0046f88c209f879efdc8169.svg" alt="K(t,r)"/> is the experiment-specific kernel representing how the signal is obtained from the distance distribution. Dipolar EPR experiments differ in the number and type of pulses, resulting in different number of dipolar pathways with different modulation amplitudes and refocusing times. In DeerLab, the signal from a general dipolar EPR experiment is modeled by the general kernel</p>
<div class="math">
<p><img src="_images/math/088743547f249e8698bcd21f52fbf4f46ccce129.svg" alt="K(t,r) = \left[\varLambda_0 + \sum_{p=1}^N \lambda_p K_0(n_p(t-T_p),r)\right]\cdot\prod_{p=1}^N B(n_p(t-T_p),\lambda_p)"/></p>
</div><p>Here, <img class="math" src="_images/math/87856a075a7935a09bc4a7e280e3936742cced0b.svg" alt="\varLambda_0"/> is the total amplitude of all unmodulated pathways, <img class="math" src="_images/math/d3c87c1c6de86df66ec20ee7bd2c97b5ca1b5975.svg" alt="N"/> is the number of modulated pathways, <img class="math" src="_images/math/0780ed2097dbadfda611b929c539ecc1534b7d59.svg" alt="\lambda_p"/> is the amplitude of the <img class="math" src="_images/math/3c6ef920c5ac243327402d5f5e968f4e344652a1.svg" alt="p"/>th modulated pathway, <img class="math" src="_images/math/23c3e755d75cefee18459676131a9c38dc8fc426.svg" alt="T_p"/> is the refocusing time of the <img class="math" src="_images/math/3c6ef920c5ac243327402d5f5e968f4e344652a1.svg" alt="p"/>th modulated pathway, and <img class="math" src="_images/math/3454290cef7bd720c9f519ec9642fbb23098ea88.svg" alt="n_p"/> is the harmonic of the <img class="math" src="_images/math/3c6ef920c5ac243327402d5f5e968f4e344652a1.svg" alt="p"/>th pathway (most often, <img class="math" src="_images/math/9d7e332292416c8d144754ef4352e4eac0abf393.svg" alt="n=1"/>). <img class="math" src="_images/math/3d19b04b8edef0b69cd79137873532891f95d75c.svg" alt="B"/> is the background decay function.</p>
<p><img class="math" src="_images/math/205ddee07c3adefd818c137c876ba0ad36e2a526.svg" alt="K_0"/> is the elementary kernel for a single dipolar pathway with 100% modulation amplitude and unlimited excitation bandwidth. It is given by</p>
<div class="math">
<p><img src="_images/math/181855daba09d98a7669935bdaeffa4d1c95bf4b.svg" alt="K_0(t,r) =
\int_0^1
\cos\left((1-3\cos^2\theta) D r^{-3} t\right)
\mathrm{d}\cos\theta"/></p>
</div><p>with the dipolar constant</p>
<div class="math">
<p><img src="_images/math/fffdb25f336ec452545d131c8774afff3af3a696.svg" alt="D =
\frac{\mu_0}{4\pi}
\frac{(\mu_\mathrm{B}g_\mathrm{e})^2}{\hbar}
\approx
2\pi\cdot 52\,\mathrm{MHz\,nm^3}"/></p>
</div><p>The closed-form expression for <img class="math" src="_images/math/205ddee07c3adefd818c137c876ba0ad36e2a526.svg" alt="K_0"/> is</p>
<div class="math">
<p><img src="_images/math/611cd22ad8610167e7c1eb6e003fdb5c2e4113a3.svg" alt="K_0(t,r) = \frac{C(\xi)}{\xi}\cos(\omega_\perp t) + \frac{S(\xi)}{\xi} \sin(\omega_\perp t)"/></p>
</div><p>with <img class="math" src="_images/math/506b8457f4e5faed1e6c358d6641776d1e6a7b42.svg" alt="\xi = \sqrt{6\omega_\perp t/\pi}"/> and the Fresnel cosine and sine integral functions</p>
<div class="math">
<p><img src="_images/math/a9737b7c1095cb9ce7ea95ba2fdb36cdd3a15bc0.svg" alt="C(\xi) = \int_0^\xi \cos\left(\frac{\pi}{2}x^2\right)\mathrm{d}x
\qquad
S(\xi) = \int_0^\xi \sin\left(\frac{\pi}{2}x^2\right)\mathrm{d}x"/></p>
</div><p>For the common model used to analyze 4-pulse DEER data, the kernel is</p>
<div class="math">
<p><img src="_images/math/ce6dd4d49582f277f9dc795f9557a5fd454640f7.svg" alt="K(t,r) = \left[(1-\lambda) + \lambda K_0(t,r)\right]\cdot B(t,\lambda)"/></p>
</div><p>This is a special case of the general kernel, with <img class="math" src="_images/math/9f224b7d775612159c7871f3cb68634eb5f0d040.svg" alt="\varLambda_0 = 1-\lambda"/>, <img class="math" src="_images/math/d40121559ed93957245f4603e25d803f38b31922.svg" alt="N=1"/>, <img class="math" src="_images/math/3311946b7d3826eedb49159687eeb5f73602d921.svg" alt="\lambda_1=\lambda"/>, <img class="math" src="_images/math/ee6b5e9cdec0f411b5f67fac578befb64dd3dfa7.svg" alt="T_1 = 0"/>, and <img class="math" src="_images/math/2b19b394479cf62f76c3720fcea6f53ef22a2503.svg" alt="n_1=1"/>.</p>
</div>
<div class="section" id="discretization">
<h2>Discretization<a class="headerlink" href="#discretization" title="Permalink to this headline">¶</a></h2>
<p>In DeerLab, all signals <img class="math" src="_images/math/aa36e9a7897037ba9bf774ef2c0b994cabae0676.svg" alt="V"/> and distributions <img class="math" src="_images/math/e8eb5584929df943469e22854d0e832b812e6a30.svg" alt="P"/> are represented as discretized vectors <img class="math" src="_images/math/8d5be6ec124c7b71ca0168fd34a49494705614c5.svg" alt="\vc{V}"/> and <img class="math" src="_images/math/a82035d7602d0044b85b18dca335af1d4b4d5bc5.svg" alt="\vc{P}"/> over discretized time domain <img class="math" src="_images/math/1a0c42828f6c0a75b9b3b5d561843eceff263a20.svg" alt="\vc{t}"/> and distance domain <img class="math" src="_images/math/7bf1a7528a64cf62dba29ce9f5a16ac7b5872138.svg" alt="\vc{r}"/>. Their elements are</p>
<div class="math">
<p><img src="_images/math/8c792c75fecf3b51d8d86e8f0ab48fa2746a223d.svg" alt="V_i = V(t_i)
\qquad
P_j = P(r_j)"/></p>
</div><p>Distance distribution vectors must have non-negative elements and are assumed to be normalized such that</p>
<div class="math">
<p><img src="_images/math/d4b2a0ce73b5180400b5d2bca8b1015fe1d49f62.svg" alt="\sum_j P_j \Delta r  = 1"/></p>
</div><p><img class="math" src="_images/math/a23c49817f47563aba88f51b566743391be34a7c.svg" alt="\Delta r"/> is the constant increment along the distance domain. DeerLab does not support non-linear distance vectors with non-constant increments.</p>
<p>All kernels <img class="math" src="_images/math/470a45f89fddfb7f621be3fa29615dc17b7434f3.svg" alt="K"/> are discretized accordingly to give kernel matrices <img class="math" src="_images/math/12f126e891944f52bda77689626ce5bb8bcc3c06.svg" alt="\mx{K}"/> with elements</p>
<div class="math">
<p><img src="_images/math/a3b90dbe261a42e26b1c301f53490f918d169242.svg" alt="K_{ij} = K(t_i,r_j) \Delta r"/></p>
</div><p>With this, a signal is obtained from a distance distribution via</p>
<div class="math">
<p><img src="_images/math/73be9cfd938521c728ce4f1d39d48386e1b233b7.svg" alt="\vc{V} = \mx{K}\vc{P}"/></p>
</div></div>
<div class="section" id="least-squares-fitting">
<h2>Least-squares fitting<a class="headerlink" href="#least-squares-fitting" title="Permalink to this headline">¶</a></h2>
<p>DeerLab uses dedicated least-squares solvers to fit models to data. The objective function and the solver depend on whether the distance distribution is parametric or non-parametric, and on whether there are background and experiment parameters to fit alongside the distance distribution.</p>
<div class="section" id="parametric-distribution">
<h3>Parametric distribution<a class="headerlink" href="#parametric-distribution" title="Permalink to this headline">¶</a></h3>
<p>To fit a model with a parametric distance distribution to an experimental signal, DeerLab solves</p>
<div class="math">
<p><img src="_images/math/c00562eaad6c98b99a9be190e139ceda9e17dc99.svg" alt="\vc{\theta}_\mathrm{fit} =
\argmin_{\vc{\theta}}
\|\vc{V}_\mr{exp}-\mx{K}[\vc{\theta}]\vc{P}[\vc{\theta}]\|^2"/></p>
</div><p>where <img class="math" src="_images/math/5920a4f5a34d2aae7a28200aec40c48096125f21.svg" alt="\vc{V}_\mr{exp}"/> indicates the experimental data and <img class="math" src="_images/math/1b4931116dfcc855ea66608f89b33f8a917f291a.svg" alt="\vc{\theta}"/> is a vector of all parameters (distribution parameters, background parameters, experiment parameters). Various constrained least-squares solvers are implemented.</p>
</div>
<div class="section" id="non-parametric-distribution">
<h3>Non-parametric distribution<a class="headerlink" href="#non-parametric-distribution" title="Permalink to this headline">¶</a></h3>
<p>To fit a model with a non-parametric distribution and no additional fitting parameters to an experimental signal, DeerLab implements several regularization approaches. The most common one is Tikhonov regularization. For this, the minimization problem is</p>
<div class="math">
<p><img src="_images/math/4b2032c5f41539183baf665d14f906c4e89fec96.svg" alt="\vc{P}_\mathrm{fit} =
\argmin_{\vc{P}\ge0}
\left(
\|\vc{V}_\mr{exp}-\mx{K}\vc{P}\|^2
+
\alpha^2
\|\mx{L}\vc{P}\|^2
\right)"/></p>
</div><p><img class="math" src="_images/math/4dce32165f8f19cca59299293bc01e93d85675a5.svg" alt="\alpha"/> is the regularization parameter, and <img class="math" src="_images/math/6f7a9a69e2ec127cd6b58b300501e929e3c0022f.svg" alt="\mx{L}"/> is the regularization operator matrix. DeerLab implements the linear non-negative least-squares solver FNNLS, as well as a few others. The <img class="math" src="_images/math/4dce32165f8f19cca59299293bc01e93d85675a5.svg" alt="\alpha"/> parameter can be optimized using a range of criteria, including L-curve, Akaike information criterion (AIC), and generalized cross validation (GCV).</p>
<p>To fit a  model with a non-parametric distance distribution and other parameters to an experimental signal, DeerLab solves</p>
<div class="math">
<p><img src="_images/math/baf54afd446395f6d441103c3c180b033a6f8d0a.svg" alt="(\vc{\theta}_\mathrm{fit},\vc{P}_\mr{fit})
=
\argmin_{\vc{\theta},\vc{P}\ge0}
\left(
\|\vc{V}_\mr{exp}-\mx{K}[\vc{\theta}]\vc{P}\|^2
+
\alpha^2
\|\mx{L}\vc{P}\|^2
\right)"/></p>
</div><p>This problem is solved directly, i.e. both <img class="math" src="_images/math/1b4931116dfcc855ea66608f89b33f8a917f291a.svg" alt="\vc{\theta}"/> ad <img class="math" src="_images/math/a82035d7602d0044b85b18dca335af1d4b4d5bc5.svg" alt="\vc{P}"/> are fitted simultaneously. To achieve this, DeerLab implements a nested optimization approach that includes regularization.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="contributing.html" class="btn btn-neutral float-right" title="Contributing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="models/ex_ridme7.html" class="btn btn-neutral float-left" title="ex_ridme7" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019-2021, Luis Fábregas Ibáñez, Stefan Stoll, and others.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>